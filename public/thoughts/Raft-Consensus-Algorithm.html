<!DOCTYPE html>
<html lang="en"><head><title>Raft Consensus Algorithm</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:title" content="Raft Consensus Algorithm"/><meta property="og:description" content="An understandable consensus algorithm A distilled version of the Raft paper. For a more graphic version, see this visualization of Raft by The Secret Lives of Data."/><meta property="og:image" content="https://wiki.likui.info/static/og-image.png"/><meta property="og:width" content="1200"/><meta property="og:height" content="675"/><link rel="icon" href="../static/icon.png"/><meta name="description" content="An understandable consensus algorithm A distilled version of the Raft paper. For a more graphic version, see this visualization of Raft by The Secret Lives of Data."/><meta name="generator" content="Quartz"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link href="../static/font/font-style.css" rel="stylesheet" type="text/css" spa-preserve/><link href="../index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://fonts.googleapis.com/css2?family=JetBrains Mono&amp;family=DM Serif Text:wght@400;700&amp;family=Bricolage Grotesque:ital,wght@0,350;0,600;1,400;1,600&amp;display=swap" rel="stylesheet" type="text/css" spa-preserve/><script src="../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("../static/contentIndex.json").then(data => data.json())</script></head><body data-slug="thoughts/Raft-Consensus-Algorithm"><div id="texture"></div><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h1 class="page-title"><a href="..">知识库</a></h1><div class="spacer mobile-only"></div><div class="search"><div id="search-icon"><p>Search</p><div></div><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search</title><desc id="desc">Search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></div><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="search-layout" data-preview="true"></div></div></div></div><div class="darkmode"><input class="toggle" id="darkmode-toggle" type="checkbox" tabindex="-1"/><label id="toggle-label-light" for="darkmode-toggle" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg></label><label id="toggle-label-dark" for="darkmode-toggle" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></label></div></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../thoughts/">thoughts</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>Raft Consensus Algorithm</a></div></nav><h1 class="article-title">Raft Consensus Algorithm</h1><p class="content-meta">May 01, 2022, 9 min read</p><ul class="tags"><li><a href="../tags/seed" class="internal tag-link">#seed</a></li><li><a href="../tags/technical" class="internal tag-link">#technical</a></li></ul></div></div><article class="popover-hint"><blockquote>
<p>An understandable <a href="../thoughts/consensus" class="internal alias" data-slug="thoughts/consensus">consensus</a> algorithm</p>
</blockquote>
<p>A distilled version of the <a href="https://raft.github.io/raft.pdf" class="external alias">Raft paper</a>. For a more graphic version, see this <a href="http://thesecretlivesofdata.com/raft/" class="external alias">visualization of Raft by The Secret Lives of Data</a>.</p>
<p>A really good <a href="https://www.youtube.com/watch?v=uXEYuDwm7e4&amp;list=PLeKd45zvjcDFUEv_ohr_HdUFe97RItdiB&amp;index=18" class="external alias">video review of the algorithm by Martin Kleppmann</a></p>
<p>For a <a href="../thoughts/Byzantine-Faults" class="internal alias" data-slug="thoughts/Byzantine-Faults">BFT</a>-resilient version of Raft, see <a href="../thoughts/Tangaroa" class="internal alias" data-slug="thoughts/Tangaroa">Tangaroa</a>.</p>
<h2 id="distributed-consensus">Distributed Consensus<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#distributed-consensus" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>When you only have one machine, it is easy to figure out what the state of that machine is in. But what happens when you have multiple machines that need to agree on some value or state?</p>
<p>How do we arrive at a shared set of state across multiple machines that can be as far as opposite sides of the world? How do we handle machines crashing and become unable to respond to incoming requests?</p>
<p>This is the problem of <em>distributed consensus</em></p>
<h2 id="replicated-state-machines">Replicated State Machines<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#replicated-state-machines" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Generally, this is done using a log of actions that are <em>replicated</em> across all machines. Keeping this replicated log consistent between all the machines is the job of the <em>consensus algorithm</em>. They allow a collection of machines to agree on some shared state which still make sense even when there is latency or unavailability.</p>
<p>In more formal language, consensus algorithms should typically have the following properties:</p>
<ol>
<li><a href="../thoughts/safety" class="internal alias" data-slug="thoughts/safety">Safety</a> in the face of network delays, partitions, packet loss, duplication, and reordering (except under certain cases where there are no known solutions, e.g. <a href="../thoughts/Byzantine-Faults" class="internal alias" data-slug="thoughts/Byzantine-Faults">Byzantine Fault Tolerance</a>)</li>
<li>Functional (available) as long as the majority of servers are operational and can communicate</li>
<li>Latency resilient and does not depend on timing of messages to ensure consistency</li>
</ol>
<p>Raft is one such consensus algorithm for managing a replicated log. It is an alternative to <a href="https://en.wikipedia.org/wiki/Paxos_(computer_science)" class="external alias">Paxos</a> which is the main consensus algorithm in use over the last decade. The main aim is to make it <em>understandable</em> to builders and students alike.</p>
<p>It is important to note that Raft assumes that all messages have been authenticated/authourized. It hands this responsibility to the <a href="../thoughts/Transport-Layer" class="internal alias" data-slug="thoughts/Transport-Layer">transport layer</a> to deal with. As such, Raft <em>does not have any protection against malicious actors</em>. More discussion in this <a href="https://groups.google.com/g/raft-dev/c/8WIrWfzIkvM" class="external alias">Google Groups conversation</a>.</p>
<h2 id="consensus">Consensus<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#consensus" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Raft implements consensus by first electing a <em>leader</em>, then giving that leader temporary but complete responsibility for managing the replicated log. When a leader fails or becomes disconnected, a new leader is elected.</p>
<p>Given this approach, Raft decomposes this consensus into 3 independent subproblems</p>
<ol>
<li>Leader election: how do we choose a new leader when an existing leader fails?</li>
<li>Log replication: how does the leader accept new log entries from clients and replicate them across all the other machines?</li>
<li><a href="../thoughts/safety" class="internal alias" data-slug="thoughts/safety">Safety</a>: when is it safe to consider log entries as ‘agreed upon’ and fully replicated across all machines?</li>
</ol>
<p>A server can only be in one of 3 states:</p>
<ol>
<li>Leader: handles all client requests</li>
<li>Follower: issues no requests but respond to requests from leaders and candidates</li>
<li>Candidate: used to elect a new leader</li>
</ol>
<p>State transitions follow the state diagram below:
<img src="../thoughts/images/raft-state-diagram.png" width="auto" height="auto" alt/></p>
<p>All Raft servers communicate using remote procedure calls (RPCs) that happen over the network. The basis consensus algorithm only requires 2 types of RPCs, RequestVote and Append-Entries. These are retried if a request times out and are issued in parallel for best performance.</p>
<h2 id="leader-election">Leader Election<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#leader-election" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Leaders are active for <em>terms</em> of arbitrary length (this is randomly determined as we will see later). These are numbered with consecutive and monotonically increasing integers.</p>
<p>Each term begins with an election in which one or more candidates attempt to become leader. If a candidate wins the election, then it serves as leader for the rest of the term.</p>
<p><img src="../thoughts/images/raft-elections.png" width="auto" height="auto" alt/></p>
<h3 id="initiate-state">Initiate State<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#initiate-state" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>Servers start up in the follower state.</p>
<p>A server remains in the follower state as long as it receives valid RPCs from a leader or candidate (this is usually in the form of a ‘heartbeat’ from a leader which is an empty AppendEntries <a href="../thoughts/RPC" class="internal alias" data-slug="thoughts/RPC">RPC</a> with no log entries).</p>
<p>If a follower receives no communication over a period of time called the <em>election timeout</em> (randomized between 150ms and 300ms), then it assumes there is no viable leader and begins an election to choose a new leader.</p>
<h3 id="beginning-an-election">Beginning an Election<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#beginning-an-election" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>A follower increments its current term and transitions to candidate state. It then votes for itself and issues RequestVote RPCs in parallel to each of the other servers in the cluster.</p>
<p>It is important to note that a server can only vote once per election. <em>It will give its vote to the first server that asks for it and meets the requirements for election.</em> A server should <em>only</em> vote for a candidate if the candidate’s log is more up-to-date than its own. If the logs have different terms, the one with the larger term is more up to date. If the logs have the same term, the longer log is more up-to-date.</p>
<p>A candidate remains a candidate until one of 3 events happens:</p>
<ol>
<li>It wins the election. It received votes from a majority of servers in the cluster. Majority rule ensures that at most one candidate can win the election for a particular term. It then sends heartbeat messages to all other servers to establish authority and prevent new elections.</li>
<li>Another server establishes itself as leader. Received an AppendEntries <a href="../thoughts/RPC" class="internal alias" data-slug="thoughts/RPC">RPC</a> from another server claiming to be leader. This claim is legitimate if the leader’s term is at least as large as the candidate’s current term.</li>
<li>A period of time goes by with no winner. Possible if many followers become candidates at the same time, votes can be split so no candidate wins majority. When this happens, each candidate times out and starts a new election by incrementing its term and initiating another election. Raft uses randomized election timeouts to ensure split votes are rare.</li>
</ol>
<p>After a leader has been elected, it beings servicing client requests.</p>
<h3 id="properties">Properties<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#properties" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>Generally, Raft will be able to elect and maintain a steady leader as long as the system roughly follows the timing requirement: <code>broadcastTime &lt; 10 * electionTimeout &lt; 100 * MTBF</code> where <code>broadcastTime</code> is amount of time for a server to send an <a href="../thoughts/RPC" class="internal alias" data-slug="thoughts/RPC">RPC</a> to every server in the cluster and <code>MTBF</code> is the mean time between failure for a server.</p>
<p>Broadcast time should be roughly an order of magnitude less than the election timeout so that leaders can reliably send heartbeat messages required to keep followers from starting elections (similar to having RTT be roughly a magnitude smaller than request timeout).</p>
<p>The election timeout should be a few orders of magnitude less than MTBF so that the system makes steady progress. When a system crashes, it will be down for roughly the period of the election timeout.</p>
<h2 id="log-replication">Log Replication<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#log-replication" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Each client request is a command to be executed by the replicated state machines. The leader appends the command to its own log as a new entry, then issues AppendEntries RPCs in parallel to each of the other servers to replicate the entry.</p>
<p>A single log entry contains the state machine command from the client request along with the term number when the entry was received by the leader. A log entry is considered ‘safely replicated’ or <em>committed</em> once it is replicated on a majority of servers.</p>
<p>After an entry is committed, it applies the entry to its own state machine and returns the result of that execution to the client. When a follower learns a log entry is committed, it too applies the entry to its own state machine.</p>
<p>The <em>Log Matching Property</em> is maintained by Raft which guarantees</p>
<ol>
<li>Log entries with same index and term number store the same command</li>
<li>Log entries with same index and term number mean that all preceding entries must identical (all log entries prior to that index are correctly replicated)</li>
</ol>
<p>When a leader comes to power, it just begins normal operation, and the logs automatically converge in response to failures of the AppendEntries consistency check.</p>
<p>To bring a follower’s log into consistency with its own, the leader must find the latest log entry where the two logs agree. To do this, the leader keeps a value <code>nextIndex</code> for each follower which is the number of the <em>next log entry the leader will send to that follower</em>. The leader pings each follower with a AppendEntries <a href="../thoughts/RPC" class="internal alias" data-slug="thoughts/RPC">RPC</a> call with that <code>nextIndex</code> value. If this call is successful, the leader knows that this follower is up to date. If it fails, then the leader decrements <code>nextIndex</code> again until it reaches a log entry that does succeed. At this point, the follower’s logs will be removed (as anything between <code>nextIndex</code> and what the follower currently has is conflicting) and the follower’s log is now consistent with the leader’s and will remain that way for the rest of the term.</p>
<h2 id="unbounded-logs-log-compaction">Unbounded Logs (Log Compaction)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#unbounded-logs-log-compaction" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>In a practical system, a log cannot grow without bounds. The simplest solution is to use snapshotting where the entire current system state is written to a snapshot on stable storage, then the entire log up until that point is discarded.</p>
<p>All snapshots are taken independently by each server. Each snapshot contains data like last included index, last included term, and the state machine state.</p>
<p>Sometimes, snapshots need to be sent from leader to followers if the followers lag behind using the InstallSnapshot <a href="../thoughts/RPC" class="internal alias" data-slug="thoughts/RPC">RPC</a>. This can happen when the leader has discarded the next log entry that needs to be send to a follower (e.g. new server joining cluster).</p>
<p>When a server receives a InstallSnapshot <a href="../thoughts/RPC" class="internal alias" data-slug="thoughts/RPC">RPC</a> call, it usually discard its entire log. In the odd case where the server receiving the <a href="../thoughts/RPC" class="internal alias" data-slug="thoughts/RPC">RPC</a> call has <em>more</em> entries in its log than the snapshot, it deletes all log entries covered by the snapshot but entries following the snapshot are still valid and must be kept.</p>
<p>Other options like log cleaning and log-structured merge trees are also possible.</p>
<h2 id="rpcs">RPCs<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#rpcs" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>All Raft RPCs are idempotent so sending multiple RPCs causes no harms (e.g. telling a follower to AppendEntries it already has does nothing).</p>
<h2 id="liveness-guarantees">Liveness Guarantees<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#liveness-guarantees" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Additionally, note that Raft (in its current specification) is <em>not resilient to omission faults</em>. This can be resolved with two additional RPCs however:</p>
<ol>
<li>PreVote: requires potential candidates to run a trial election to test if they can win an election before incrementing their term and running a normal election using RequestVote</li>
<li>QuorumCheck: requiring leaders to actively step down if they do not receive AppendEntries responses from a majority of servers</li>
</ol>
<h2 id="implementation">Implementation<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#implementation" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>You can find a reference implementation on GitHub</p>
<ul>
<li><a href="https://github.com/jackyzha0/miniraft" class="external alias">Miniraft Github Repository</a></li>
<li><a href="https://jzhao.xyz/miniraft/miniraft/" class="external alias">Miniraft Crate Documentation</a></li>
</ul></article></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:false,&quot;removeTags&quot;:[]}"></div><svg version="1.1" id="global-graph-icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
	s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
	c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
	C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
	c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
	v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
	s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
	C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
	S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
	s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
	s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:false,&quot;removeTags&quot;:[]}"></div></div></div><div class="backlinks"><h3>Backlinks</h3><ul class="overflow"><li><a href="../thoughts/Byzantine-Broadcast" class="internal">Byzantine Broadcast</a></li><li><a href="../thoughts/Matrix" class="internal">Matrix</a></li><li><a href="../thoughts/PBFT" class="internal">PBFT</a></li><li><a href="../thoughts/Projects" class="internal">Projects</a></li><li><a href="../thoughts/Rhizome-Proposal" class="internal">Rhizome Proposal</a></li><li><a href="../thoughts/Rhizome-Research-Log" class="internal">Rhizome Research Log</a></li><li><a href="../thoughts/Tangaroa" class="internal">Tangaroa</a></li><li><a href="../thoughts/Tendermint" class="internal">Tendermint</a></li><li><a href="../thoughts/consensus" class="internal">Consensus</a></li><li><a href="../thoughts/math" class="internal">Math</a></li><li><a href="../thoughts/message-broadcast" class="internal">Message broadcast</a></li></ul></div></div></div><footer class><hr/><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.2.2</a> © 2024</p><ul><li><a href="https://github.com/ilikui">GitHub</a></li><li><a href="https://twitter.com/kico">Twitter</a></li></ul></footer></div></body><script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/copy-tex.min.js" type="application/javascript"></script><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script type="module">
          let mermaidImport = undefined
          document.addEventListener('nav', async () => {
            if (document.querySelector("code.mermaid")) {
              mermaidImport ||= await import('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs')
              const mermaid = mermaidImport.default
              const darkMode = document.documentElement.getAttribute('saved-theme') === 'dark'
              mermaid.initialize({
                startOnLoad: false,
                securityLevel: 'loose',
                theme: darkMode ? 'dark' : 'default'
              })

              await mermaid.run({
                querySelector: '.mermaid'
              })
            }
          });
          </script><script src="../postscript.js" type="module"></script></html>